<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kontrol Servo Wemos</title>
  <style>
    body{font-family:system-ui,Arial;margin:24px}
    .card{max-width:420px;padding:16px;border:1px solid #ddd;border-radius:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    button{padding:10px 16px;border-radius:10px;border:1px solid #ccc;cursor:pointer}
    input[type=number]{width:100px;padding:8px;border-radius:8px;border:1px solid #ccc}
    .muted{color:#666;font-size:.9em}
    .state{display:inline-block;padding:6px 12px;border:1px solid #ccc;border-radius:999px;min-width:72px;text-align:center}
  </style>
</head>
<body>
  <div class="card">
    <h3>Kontrol Servo (Wemos)</h3>
    <p>Target: <code id="base"></code></p>

    <div class="row">
      <span class="state" id="cur">-°</span>
      <button onclick="center()">Center (90°)</button>
    </div>

    <div class="row">
      <button onclick="gotoPos(0)">0°</button>
      <button onclick="gotoPos(45)">45°</button>
      <button onclick="gotoPos(90)">90°</button>
      <button onclick="gotoPos(135)">135°</button>
      <button onclick="gotoPos(180)">180°</button>
    </div>

    <div class="row">
      <input id="pos" type="number" min="0" max="180" value="90">
      <button onclick="goInput()">Kirim</button>
    </div>

    <div class="row">
      <input id="slider" type="range" min="0" max="180" value="90" oninput="live(this.value)" />
      <span id="sv">90°</span>
      <button onclick="gotoPos(parseInt(document.getElementById('slider').value,10))">Kirim Slider</button>
    </div>

    <p class="muted">Catatan: Pastikan IP sudah sesuai</p>
  </div>

<script>
  // --- GANTI IP WEMOS DI SINI ---
  const BASE = 'http://172.17.91.135';
  // -----------------------------------
  document.getElementById('base').textContent = BASE;

  const cur = document.getElementById('cur');
  const sv  = document.getElementById('sv');

  async function request(path){
    const r = await fetch(BASE + path, { mode: 'cors' });
    if(!r.ok) throw new Error(r.status);
    return r.json();
  }

  async function gotoPos(p){
    p = Math.max(0, Math.min(180, p|0));
    try{
      const j = await request('/servo?pos=' + p);
      cur.textContent = (j.pos ?? p) + '°';
    }catch(e){
      cur.textContent = 'ERR';
      console.error(e);
    }
  }

  async function center(){ await gotoPos(90); }

  function live(v){
    sv.textContent = v + '°';
  }
  function goInput(){
    const v = parseInt(document.getElementById('pos').value, 10);
    gotoPos(isNaN(v) ? 90 : v);
  }

  // optional: set awal ke tengah
  center();
</script>
</body>
</html>
